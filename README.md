#  ServiceLevelProject

### 2022.11.07 ~ 2022.12.07 (30ì¼, ì•½ 4ì£¼)

|                          ì•± ì•„ì´ì½˜                           | ìŠ¤í¬ë¦°ìƒ·                                                     |
| :----------------------------------------------------------: | ------------------------------------------------------------ |
| <img src="https://user-images.githubusercontent.com/55547933/208854647-52f47253-a0d7-4d8e-afd2-21c378837b9a.png"> | <img src="https://user-images.githubusercontent.com/55547933/209553750-fc85aabc-3ba0-4258-ac60-f3f4a62b7406.jpg" width="500px" height="500px"> |
|                             ê°œìš”                             | ë””ìì´ë„ˆ, ì„œë²„ê°œë°œìê°€ ìˆëŠ” í”„ë¡œì íŠ¸ ë¡œ ìƒˆì‹¹ ìŠ¤í„°ë””ì›ì„ ì°¾ê³  ì±„íŒ…í• ìˆ˜ìˆëŠ” ì•± í”„ë¡œì íŠ¸ |
|                         ë””ìì¸ íŒ¨í„´                          | MVC, Repository, Singleton                                   |
|                             í™”ë©´                             | UIKit, SnapKit, AutoLayout                                   |
|                       ì˜ì¡´ì„± ê´€ë¦¬ ë„êµ¬                       | CocoaPod , Swift Package Manager                             |
|                             ì„œë²„                             | Firebase Auth, Firebase Cloud Messaging                      |
|                         ë°ì´í„°ë² ì´ìŠ¤                         | Realm                                                        |
|                           ë„¤íŠ¸ì›Œí¬                           | Alamofire, async/await                                       |
|                         ë””ë²„ê¹… ìŠ¤í‚¬                          | LLDB                                                         |
|                          ë¼ì´ë¸ŒëŸ¬ë¦¬                          | socket.io, NMapsMap, Tabman, Rxswift, RxCocoa                |
|                             í˜‘ì—…                             | Confluence, Swagger, Github, Figma                           |
|                             ì°¸ê³                              | [íšŒê³ ](https://hotsanit.tistory.com/107)                     |



## ğŸŸ¢ ê¸°ìˆ  ëª…ì„¸

- í”„ë¡œí† ì½œ ì—ì„œ **ë„¤íŠ¸ì›Œí¬ ë¡œì§**ì„ **where Self** ë¥¼ í™œìš©í•˜ì—¬ **ì±„íƒí•  ViewControllerë“¤** ì œì•½
- í”„ë¡œí† ì½œë¡œ **ë„¤íŠ¸ì›Œí¬ ë¡œì§**ë“¤ì„ **ëª¨ë“ˆí™”**í•˜ì—¬ ì™€ **ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§**ê³¼ ë¶„ë¦¬ í•˜ì—¬ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• ê³¼ ë¶„ë¦¬
- **ì •ê·œí‘œí˜„ì‹**ìœ¼ë¡œ ë¬¸ìë‚˜ íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ì‹œ ì¸ì¦ìš”ì²­ì´ ì•ˆë˜ê²Œ í•¨ìœ¼ë¡œì„œ ë¶ˆí•„ìš”í•œ ìš”ì²­ ë¬¸ì œ í•´ê²°
- **Alamofire** **URLRequestConvertible**ë¡œ ë„¤íŠ¸ì›Œí¬ Router ëª¨ë“ˆí™”ë¡œ ë§¤ í†µì‹ ì—í•„ìš”í•œ **íŒŒë¼ë¯¸í„°,í•´ë”,HTTP ë©”ì„œë“œ ìº¡ìŠí™”**
- **await/async** ë¡œ ë¹„ë™ê¸° ì½”ë“œë¥¼ ë™ê¸°ì½”ë“œ ì²˜ëŸ¼ ì‘ì„±í•˜ì—¬ ì½œë°±í•¨ìˆ˜ê°€ **ì—¬ëŸ¬ë²ˆ í˜¸ì¶œ ë ë•Œ ì œì–´íë¦„ì´ ë³µì¡**í•˜ê³  ë§¤ê°œë³€ìˆ˜ **@escaping êµ¬ë¬¸ì´ ì½ê¸°ì–´ë ¤ì›Œ  ì½”ë“œ ê°€ë…ì„±ì„ ë†’ì„**
- **socket io** ìœ¼ë¡œ **Realm DB** ë¥¼ ì¨ì„œ ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œì´ ê³¼í•˜ê²Œ ë˜ì§€ ì•Šê²Œ 1:1 ì±„íŒ… êµ¬í˜„, ì†Œì¼“ ì—°ê²° ë° í•´ì œ ì‹œì ì— ëŒ€í•´ ëŒ€ì‘
- **Firebase Auth** ë¡œ **íœ´ëŒ€í° ì¸ì¦** ì„ ë°›ê³  **ìƒíƒœì½”ë“œ**ë¥¼ í†µí•´ ë¡œê·¸ì¸ ì„±ê³µ í™”ë©´ í˜¹ì€ íšŒì›ê°€ì… **í™”ë©´ ë¶„ê¸°ì²˜ë¦¬**
- **Firebase Cloud Messaging ì—ì„œ ë°œê¸‰ë°›ì€ FCM token** ìœ¼ë¡œ **ë©€í‹°ë””ë°”ì´ìŠ¤ ëŒ€ì‘**
- **Confluence** ê¸°íšì•ˆì„ ë³´ë©´ì„œ **ìš”êµ¬ì‚¬í•­ í•„ìˆ˜ ê¸°ëŠ¥ êµ¬í˜„ ë° í™”ë©´ ë¡œì§ ì„¤ê³„ ([í™”ë©´ ë¡œì§ ë§í¬](https://www.figma.com/file/qxHHEH3ETn9gviJU0gj1z0/SLP-Service-Flow?node-id=849%3A845&t=sTkjixRIIAvCy6zm-0))**
- ì˜¨ë³´ë”© í™”ë©´ì„ **PageViewController**ë¥¼ í™œìš©í•˜ì—¬ ì•± ì²˜ìŒì‹œì‘ì‹œ í˜¹ì€ íšŒì› íƒˆí‡´ì— ë§Œ ë³´ì´ê²Œ **í™”ë©´ ë¶„ê¸°ì²˜ë¦¬**
- **Timer**ë¥¼ í™œìš©í•˜ì—¬ 5ì´ˆë§ˆë‹¤ ë§¤ì¹­ìƒíƒœ í™•ì¸í•˜ëŠ” **API ë°˜ë³µí˜¸ì¶œ**



## ğŸ”´ ê³ ë¯¼í•œ ë‚´ìš© ë° íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
<details> <summary>ì´ìŠˆ 1. í”„ë¡œí† ì½œ ì±„íƒí• ìˆ˜ìˆëŠ” ViewController ë“¤ì„ ì œì•½</summary><br>
ğŸ”´ ê³ ë¯¼í•œ ì˜ì—­ <br><br>
í”„ë¡œí† ì½œë¡œ ë„¤íŠ¸ì›Œí¬ ë¡œì§ì„ ë§Œë“ í›„ ì•„ë˜ì™€ê°™ì´ UIViewController ë¡œ ì œì•½ì„ ê±¸ë©´ studyPostDodge ë©”ì†Œë“œê°€ ì–´ëŠ ViewControllerì—ì„œ ì±„íƒí•´ì„œ ì‚¬ìš©ì´ë˜ëŠ”ì§€ ì•Œê¸°ê°€ ì–´ë µê³ 
ë„¤íŠ¸ì›Œí¬ë¡œì§ì— import UIKitì„ í•´ì£¼ëŠ”ê²Œ ì í•©í•˜ì§€ ì•Šë‹¤ê³  ë³´ì¸ë‹¤.<br>

<img width="852" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-12-22 á„‹á…©á„’á…® 3 12 58" src="https://user-images.githubusercontent.com/55547933/209069133-fc4b6836-5cf9-4163-86a6-fd0319e212cf.png"><br>

ğŸ”µ í•´ê²°<br><br>
ì•„ë˜ì™€ê°™ì´ íŠ¹ì • ë·°ì»¨íŠ¸ë¡¤ëŸ¬(ChattingViewController)ì—ì„œë§Œ studyPostdodgeë©”ì†Œë“œë¥¼ ì‚¬ìš©í•œë‹¤ê³  ì œì•½ì„ ì£¼ì–´ì„œ ì–´ëŠ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ì†Œë“œì¸ì§€ ëª…ì‹œ!<br>
```swift
// DodgeProtocol.swift
import Foundation

protocol DodgeProtocol: APIProtocol, APIQueueProtocol  {
    func studyPostDodge(otheruid: String)
}

extension DodgeProtocol where Self: ChattingViewController {

    
    func studyPostDodge(otheruid: String) {
        apiQueue.studyPostDodge(otheruid: otheruid) { [weak self] data in
            do {
                switch data {
                case .success:
                    print(data)
                    self?.view.makeToast("ìŠ¤í„°ë”” ì·¨ì†Œ ì„±ê³µ")
                case .failure(.otherUIDError):
                    self?.view.makeToast("ì˜ëª»ëœ otheruid ìš”ì²­")
 
                case .failure(.notUserError):
                    self?.view.makeToast("ë¯¸ê°€ì… íšŒì›")
                case .failure(.tokenErorr):
                    self?.view.makeToast("í† í° ë§Œë£Œ")
                    self?.refreshIdToken { [weak self] in
                        self?.studyPostDodge(otheruid: otheruid)
                    }
                case .failure(.serverError):
                    self?.view.makeToast("ì„œë²„ ì—ëŸ¬")
                case .failure(.clientError):
                    self?.view.makeToast("í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬")
                }
            }
            catch{
                print("ì—ëŸ¬ì•¼")
                return
            }
        }
    }
}
```
</details>



<details> <summary>ì´ìŠˆ 2. í† í°ì´ ë§Œë£Œë˜ëŠ” ìƒí™©ì—ì„œ í† í° ê°±ì‹ ì´ ë¬´í•œìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ë¬¸ì œ</summary><br>
ğŸ”´ ì´ìŠˆ <br><br>
í† í°ê°±ì‹ í•˜ëŠ”ê²Œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ê¸°ë–„ë¬¸ì— í† í°ê°±ì‹ í•˜ê³  ë‹¤ì‹œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ë©”ì†Œë“œ í˜¸ì¶œì‹œ ë¬´í•œìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ë¬¸ì œê°€ ë°œìƒ<br>
<br>

ğŸ”µ í•´ê²°<br><br>
completion Handlerë¡œ í† í°ê°±ì‹ í›„ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ë©”ì†Œë“œ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°
<br>
```swift
func studyPostRequest(otheruid: String) {
        apiQueue.studyPostRequest(otheruid: otheruid) { [weak self] data in
            do {
                switch data {
                case .success:
                    self?.view.makeToast("ìŠ¤í„°ë”” ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤")
                case .failure(.alreadyTomeRequest):
                    self?.view.makeToast("ìƒëŒ€ë°©ì´ ì´ë¯¸ ë‚˜ì—ê²Œ ìŠ¤í„°ë”” ìš”ì²­í•œ ìƒíƒœ")
                    self?.studyPostAccept(otheruid: otheruid)

                case .failure(.oppnentStopRequest):
                    self?.view.makeToast("ìƒëŒ€ë°©ì´ ìŠ¤í„°ë””ì°¾ê¸°ë¥¼ ê·¸ë§Œë‘ì—ˆìŠµë‹ˆë‹¤.")
                case .failure(.notUserError):
                    self?.view.makeToast("ë¯¸ê°€ì… íšŒì›")
                case .failure(.tokenErorr):
                    self?.view.makeToast("í† í° ë§Œë£Œ")
                    self?.refreshIdToken { [weak self] in
                        self?.studyPostRequest(otheruid: otheruid)
                    }
                case .failure(.serverError):
                    self?.view.makeToast("ì„œë²„ ì—ëŸ¬")
                case .failure(.clientError):
                    self?.view.makeToast("í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬")

                }
            }
            catch let error{
                print(error)
            }
        }
    }
}

//APIProtocol.swift
@objc protocol APIProtocol {
    @objc optional func presentVC()
    @objc optional func refreshIdToken()
}

extension APIProtocol where Self: UIViewController {
    
    typealias completion = ( () -> Void)
    
    func refreshIdToken(completion: @escaping completion) {
        let currentUser = Auth.auth().currentUser
        currentUser?.getIDTokenForcingRefresh(true) { idToken, error in
            if error != nil {
                self.view.makeToast("í† í° ê°±ì‹  ì—ëŸ¬")
                return;
            }
            print("ê°±ì‹ í•œ idToken",idToken as Any)
            UserDefaults.standard.set(idToken!, forKey: "token")
            completion() 
        }
    }
}
```

</details>


<details> <summary>ì´ìŠˆ 3. íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥ë¶€ë¶„ì—ì„œ ìˆ«ìì´ì™¸ í•œê¸€ ë³µì‚¬ë¶™ì—¬ë„£ê¸° í—ˆìš© ë¬¸ì œ</summary><br>
ğŸ”´ ì´ìŠˆ <br><br>
íœ´ëŒ€í° ì¸ì¦ ìš”ì²­ì‹œ ë¬¸ìì—´ ì…ë ¥ì‹œì—ë„ Firebase Authë¡œ ì¸ì¦ì„ ìš”ì²­ì´ ë˜ëŠ” ë¬¸ì œê°€ìˆì—ˆë‹¤. <br>
<br>

ğŸ”µ í•´ê²°<br><br>
ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ìœ íš¨ì„±ê²€ì‚¬ë¥¼ í†µí•´ ìœ íš¨í•˜ì§€ì•Šì€ ìˆ«ìí¬ë§·ê³¼ ë¬¸ìì—´ì´ TextFieldì— ì…ë ¥ì‹œ ì¸ì¦ìš”ì²­ì„ ë³´ë‚´ì§€ì•ŠìŒ.
<br>
```swift
// ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ìœ íš¨ì„±ê²€ì‚¬
extension LoginViewController {
    func isValidPhone(phone: String?) -> Bool {
        guard phone != nil else { return false }
        let phoneRegEx = #"^\(?\d{3}\)?[ -]?\d{3,4}[ -]?\d{4}$"#
        guard let valid = phone.range(of: phoneRegEx, options: .regularExpression) != nil
        return valid
    }
   
      
      //MARK: textfieldì˜ textê°€ ë³€ê²½ì´ìˆì„ë–„
      loginView.phoneNumberTextField.rx.text.orEmpty
          .observe(on: MainScheduler.asyncInstance)
          .withUnretained(self)
          .bind { (vc,textfield) in
              
              /// ê¸€ììˆ˜ ì œí•œ
              guard vc.checkMaxLength(textField: vc.loginView.phoneNumberTextField, maxLength: 13) else {return}
              
              // ìœ íš¨í•œ ìˆ«ìí˜•íƒœë©´ ìƒ‰ìƒë³€í™˜
              guard !self.isValidPhone(phone: textfield) {
                 vc.loginView.phoneButton.backgroundColor = BrandColor.green
                  return
              }
              vc.loginView.phoneButton.backgroundColor = Grayscale.gray6
              let test = vc.loginView.phoneNumberTextField
              switch test.text?.count {
                  case 4:
                  if test.text?.filter({$0 == "-"}).count == 1 {
                          test.deleteBackward()
                      } else {
                          test.text?.insert("-", at: test.text?.index(test.text?.startIndex, offsetBy: 3))
                      }
                      vc.loginView.phoneNumberTextField.text? = test.text?
                  case 9:
                  if test.text?.filter({$0 == "-"}).count == 2 {
                          test.deleteBackward()
                      } else {
                          test.text?.insert("-", at: test.text?.index(test.text?.startIndex, offsetBy: 8))
                      }
                      vc.loginView.phoneNumberTextField.text? = test.text?
                  default:break
              }
          }
          .disposed(by: disposeBag)
    }
}
```

</details>

<details> <summary>ì´ìŠˆ 4. ì±„íŒ… ëŒ€í™”ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë¶€ë¶„ì—ì„œ ì±„íŒ…í• ë•Œ ë§ˆë‹¤ ê³„ì†í•´ì„œ í˜¸ì¶œ ë˜ëŠ” ë¬¸ì œ</summary><br>
ğŸ”´ ì´ìŠˆ <br><br>
ì±„íŒ…ë©”ì„¸ì§€ë¥¼ ë³´ë‚¼ë–„ë§ˆë‹¤ ì±„íŒ…ëŒ€í™”ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë°©ì‹ì€ ê³¼ë„í•œ í˜¸ì¶œì´ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí• ê²ƒê°™ë‹¤. <br>
<br>

ğŸ”µ í•´ê²°<br><br>
ì²˜ìŒ ì±„íŒ…ëª©ë¡ì„ Realm DBì— ì €ì¥í•˜ê³  ì´í›„ì˜ ì±„íŒ…ì„ ë³´ë‚´ê³  ë³´ë‚¸ë‚´ìš©ì€ Local Realm DBì—ì„œ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¤ëŠ”í˜•íƒœë¡œ ì„œë²„ì— Sendë§Œ ë³´ë‚´ëŠ” requestë§Œ ë³´ë‚´ê³  chatPostListìš”ì²­ì€ ì²˜ìŒ viewDidloadì‹œ í•œë²ˆë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤! 
<br>
```swift
// chatPostListë¥¼ í†µí•´ ì„œë²„ì—ì„œ ëŒ€í™”ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ Realmì— ì €ì¥í•œë‹¤.
class ChattingViewController {
    override func viewDidLoad() {
        chatPostList(lastchatDate: lastchatDate, from: UserDefaults.standard.string(forKey: "otheruid")!) { [weak self] data in
            self?.recentChattingInfo = data
            do {
                print(self?.repository.localRealm.configuration.fileURL! as Any)
                try self?.repository.localRealm.write {
                    self?.repository.localRealm.deleteAll()
                    self?.test = (data?.payload.count)!
                    data?.payload.forEach{
                        let value = ChatData(to: $0.to!, from: $0.from!, chat: $0.chat!, createdAt: $0.createdAt!)
                        self?.repository.localRealm.add(value)
                    }
                }
                self?.configureTableView()
                self?.collectionViewConfigure()
            }catch let error {
                 print(error)
              }
        }
}

extension ChattingViewController {
    func bind() {
        // ë©”ì„¸ì§€ ì „ì†¡ì „ì†¡í›„ DBì™€ chatPostSendë©”ì†Œë“œë¡œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­
        chattingView.sendButton.rx
            .tap
            .map {self.chattingView.sendTextView.text}
            .withUnretained(self)
            .bind { (vc,val) in
                vc.chatPostSend(chat: val!, to: UserDefaults.standard.string(forKey: "otheruid")!)
                vc.chattingView.sendTextView.text = ""
                let chatContent = ChatData(to:UserDefaults.standard.string(forKey: "otheruid")! , from: UserDefaults.standard.string(forKey: "Myuid")!, chat: val!, createdAt: "")
                self.repository.addChat(item: chatContent)
                
                vc.chattingView.tableView.reloadData()
            }
            .disposed(by: disposeBag)
      }
}
```

</details>

<details> <summary>ì´ìŠˆ 5. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì‹œ ë°°ì—´ë¡œ ìš”ì²­í• ë–„ bracket ë¬¸ì œ</summary><br>
ğŸ”´ ì´ìŠˆ <br><br>
alamofireëŠ” request ë°°ì—´ì„ ë³´ë‚¼ë–„ [](ë¸Œë¼ì¼“)ì„ ë‹¬ê³  ë³´ë‚´ì§€ëŠ”ë° ì´ ë•Œë¬¸ì— ì„œë²„ìª½ì—ì„œ ê±°ë¶€í•˜ëŠ” ìƒí™©<br>
<br>

ğŸ”µ í•´ê²°<br><br>
Alamofire ê³µì‹ë¬¸ì„œë¥¼ ë³´ê³  ì°¸ê³ í•˜ì—¬ ë¸Œë¼ì¼“ì„ ì œê±°í•˜ëŠ” ë°©ë²•ì„ ì‹œë„
<br>
```swift
/func queueRequest(lat: Double, long: Double, studylist: [String], completionHandler: @escaping QueuPostHandler ) {
        let api = APIHeader.queue(lat: lat, long: long, studylist: studylist)
        AF.request(api.url, method: api.method, parameters: api.parameters , encoding: URLEncoding(arrayEncoding: .noBrackets), headers: api.headers).validate().responseData { response in
            switch response.result {
            case .success(let data):
                completionHandler(.success(data))
            case .failure :
                guard let customError = queuePostErorr(rawValue: response.response!.statusCode) else{return}
                completionHandler(.failure(queuePostErorr(rawValue: customError.rawValue)!))
            }
        }
    }
```

ğŸŸ¢ ì°¸ê³  <br><br>
[Alamofire ë§í¬](https://github.com/Alamofire/Alamofire/blob/master/Documentation/Usage.md#configuring-the-encoding-of-array-parameters) <br>
<img width="932" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-12-23 á„‹á…©á„’á…® 3 10 22" src="https://user-images.githubusercontent.com/55547933/209281719-5c242a2d-1b18-4b02-b0a7-b66678c885a3.png">

</details>

